<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AnalySAR — Analysis</title>
  <link rel="icon" href="img/LOGOANALYSAR.png" type="image/png"/>
  <link rel="stylesheet" href="css/style.css"/>
</head>
<body class="doc-body">
  <header class="doc-header">
    <a href="index.html" class="back-link">← Back to Viewer</a>
    <h1>AnalySAR — Analysis</h1>
    <p class="subtitle">
      How we process Sentinel-1 and how to interpret the information panel, metrics and the flood <strong>Z-score</strong>.
    </p>
    <div class="tags-row">
      <span class="tag">AOI: <b>Tabasco, MX</b></span>
      <span class="tag">Windows: <b>Oct · Nov–Dec</b></span>
      <span class="tag">Mask: <b>Z-score threshold</b></span>
      <span class="tag">Volume*: <b>Area × 0.5 m</b></span>
    </div>
    <p class="small-note">*Volume is a simple estimate using an assumed mean depth of 0.5 m.</p>
  </header>

  <main class="doc-main">

    <section class="doc-grid">
      <div class="doc-card">
        <h2>1) Processing pipeline (Google Earth Engine)</h2>
        <ul class="bullet">
          <li><b>Data:</b> Sentinel-1 GRD (IW, VV polarization), clipped to Tabasco.</li>
          <li><b>Temporal compositing:</b> monthly averages for <b>Oct</b> (Before) and <b>Nov–Dec</b> (After) per year.</li>
          <li><b>Difference image:</b> <code>D = After − Before</code> (dB).</li>
          <li><b>Z-score flood mask:</b> pixels where <code>D &lt; μ − kσ</code> using μ,σ computed over the AOI.</li>
          <li><b>Exports:</b> GeoJSON layers (Before / After / All Water) and a CSV with μ, σ, k, threshold, min/max and scene counts.</li>
        </ul>
      </div>

      <div class="doc-card">
        <h2>2) Web visualization</h2>
        <ul class="bullet">
          <li><b>Mapbox GL JS:</b> 3D terrain, interactive layers rendered as <code>fill-extrusion</code> (color = stage).</li>
          <li><b>Turf.js:</b> computes per-layer water area (km²), affected %, polygon count.</li>
          <li><b>Chart.js:</b> side-by-side view of Oct vs Nov–Dec vs “All Water”.</li>
          <li><b>UI:</b> pills to pick primary stage; pretty layer toggles; centered timeline; mobile-friendly panels.</li>
        </ul>
      </div>
    </section>

    <section class="doc-card">
      <h2>3) Information panel — metrics</h2>
      <div class="table-scroll">
        <table class="doc-table">
          <thead>
            <tr><th>Metric</th><th>How we compute it</th><th>Unit</th><th>What it means</th></tr>
          </thead>
          <tbody>
            <tr>
              <td>Area</td>
              <td><code>turf.area(geojson) / 1e6</code></td>
              <td>km²</td>
              <td>Total surface covered by water (per stage and year).</td>
            </tr>
            <tr>
              <td>Affected %</td>
              <td><code>Area / 24,738 × 100</code></td>
              <td>%</td>
              <td>Share of Tabasco’s area that is water for that layer.</td>
            </tr>
            <tr>
              <td>Estimated Volume</td>
              <td><code>Area (m²) × 0.5 m</code> → divided by <code>1e6</code></td>
              <td>M m³</td>
              <td>Magnitude estimate with a constant mean depth (0.5 m).</td>
            </tr>
            <tr>
              <td>Polygons</td>
              <td><code>geojson.features.length</code></td>
              <td>count</td>
              <td>Fragmentation: many small patches vs few large water bodies.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section class="doc-card">
      <h2>4) Z-score flood mask — deeper dive</h2>
      <p>
        For each year we compute a difference image <code>D = After − Before</code> (both are Sentinel-1 VV averages in dB).  
        Over the AOI we estimate the mean <b>μ</b> and standard deviation <b>σ</b> of <code>D</code>.  
        Then we pick a sensitivity <b>k</b> (typically 1.5), and flag floods where <code>D &lt; μ − kσ</code>.
      </p>
      <div class="z-grid spaced doc-z">
        <div><div class="z-title">Mean (μ)</div><div class="z-val">Average of D (dB)</div></div>
        <div><div class="z-title">Std Dev (σ)</div><div class="z-val">Spread of D (dB)</div></div>
        <div><div class="z-title">k</div><div class="z-val">Sensitivity (≈ 1.0–2.0)</div></div>
        <div><div class="z-title">Threshold</div><div class="z-val"><b>μ − kσ</b> (dB)</div></div>
      </div>

      <div class="table-scroll" style="margin-top:10px">
        <table class="doc-table">
          <thead><tr><th>k</th><th>Behavior</th><th>When to use</th></tr></thead>
          <tbody>
            <tr><td>1.0</td><td>More sensitive (more pixels flagged)</td><td>Exploratory analysis, wetter periods</td></tr>
            <tr><td>1.5</td><td>Balanced</td><td>General purpose</td></tr>
            <tr><td>2.0</td><td>Conservative (fewer pixels)</td><td>Reducing false positives</td></tr>
          </tbody>
        </table>
      </div>

      <p style="margin-top:10px">
        The “<b>All Water</b>” layer in the viewer corresponds to the area where this Z-score condition holds.  
        The info card exposes μ, σ, the chosen k, and the resulting threshold, plus the min/max of D and the number of scenes used in the Oct and Nov–Dec windows.
      </p>
    </section>


<!-- 4a) Visual walkthrough — the four layers -->
<section class="doc-card">
  <h2>4a) Visual walkthrough — the four layers</h2>
  <p class="subtitle">Each image is a snapshot from Google Earth Engine for Tabasco.</p>

  <div class="doc-grid doc-grid-images">
    <figure class="doc-figure">
      <img src="img/analysis/Before.png" alt="Sentinel-1 VV composite — October (Before)" loading="lazy" />
      <figcaption>
        <b>Before (October)</b> — VV backscatter (dB) prior to peak floods.  
        Dark tones ≈ calm open water / smooth surfaces; bright tones ≈ roughness (urban, vegetation).
      </figcaption>
    </figure>

    <figure class="doc-figure">
      <img src="img/analysis/After.png" alt="Sentinel-1 VV composite — Nov–Dec (After)" loading="lazy" />
      <figcaption>
        <b>After (Nov–Dec)</b> — VV backscatter after the event window.  
        Newly formed/expanded water tends to appear darker relative to October where inundation occurs.
      </figcaption>
    </figure>

    <figure class="doc-figure">
      <img src="img/analysis/Difference.png" alt="Difference image D = After − Before (dB)" loading="lazy" />
      <figcaption>
        <b>Difference (After − Before)</b> — per-pixel change in dB.  
       
      </figcaption>
    </figure>

    <figure class="doc-figure">
      <img src="img/analysis/Zscore.png" alt="Z-score mask: pixels where D < μ − kσ" loading="lazy" />
      <figcaption>
        <b>Flood (Z-score)</b> — Mask of pixels where <code>D &lt; μ − kσ</code> (cyan).  
        This is what we vectorize and publish as <i>All Water</i> in the viewer; it adapts per year to scene statistics.
      </figcaption>
    </figure>
  </div>

  <ul class="bullet" style="margin-top:8px">
    <li><b>Why difference?</b> It cancels static bright/dark patterns and highlights change tied to inundation.</li>
    <li><b>Why Z-score?</b> A scene-adaptive threshold reduces false positives from wind, incidence angle and local texture.</li>
    <li><b>Tip:</b> Check the info card (μ, σ, k, threshold, min/max, scene counts) to judge year-to-year comparability.</li>
  </ul>
</section>
<!-- 4b) Study hypothesis — rationale and testable predictions -->
<section class="doc-card">
  <h2>4b) Study hypothesis — rationale and testable predictions</h2>

  <p class="subtitle">
    <b>Hypothesis.</b> If we extract yearly “Before/After” Sentinel-1 VV composites from Google Earth Engine (GEE),
    compute the difference image <code>D = After − Before</code>, and classify floods with a scene-adaptive
    Z-score threshold, then the resulting vectors will consistently delineate seasonal inundation in Tabasco and
    track interannual variability with sufficient fidelity to support planning and risk monitoring.
  </p>

  <div class="doc-grid">
    <div class="doc-card" style="background:rgba(255,255,255,.03)">
      <h3>Why this should work</h3>
      <ul class="bullet">
        <li><b>Physics:</b> Calm open water strongly reduces VV backscatter (appears darker). Flooding therefore drives negative change in dB.</li>
        <li><b>Change logic:</b> Differencing (<code>After − Before</code>) cancels static brightness patterns and highlights event-driven change.</li>
        <li><b>Adaptivity:</b> A Z-score threshold (<code>D &lt; μ − kσ</code>) adapts to each year’s distribution, controlling false positives across scenes.</li>
        <li><b>Smoothing + vectorization:</b> Median filters remove speckle; polygonization yields operational, GIS-ready layers.</li>
      </ul>
    </div>

    <div class="doc-card" style="background:rgba(255,255,255,.03)">
      <h3>How we extracted data</h3>
      <ul class="bullet">
        <li><b>Source:</b> <code>COPERNICUS/S1_GRD</code> (IW, VV), clipped to Tabasco AOI.</li>
        <li><b>Windows:</b> <b>Before = Oct 1–15</b>, <b>After = Nov 20–Dec 5</b> (per year 2014–2025).</li>
        <li><b>Composites:</b> Mosaic within each window, then apply <code>focal_median</code> to reduce speckle.</li>
        <li><b>Difference:</b> <code>D = After_s − Before_s</code>; compute <b>μ</b>, <b>σ</b>, <b>min/max</b> over the AOI.</li>
        <li><b>Z-score mask:</b> Flag floods where <code>D &lt; μ − kσ</code> with <code>k ≈ 1.5</code>; self-mask and vectorize (area filter).</li>
        <li><b>Exports:</b> GeoJSON for <i>Before</i>, <i>After</i>, and <i>All Water (Z-score)</i> plus a per-year CSV of stats (μ, σ, k, threshold, min/max, scene counts).</li>
      </ul>
    </div>
  </div>

  <div class="table-scroll" style="margin-top:10px">
    <table class="doc-table">
      <thead>
        <tr>
          <th>Prediction if hypothesis holds</th>
          <th>How we check it</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Negative differences concentrate along rivers, floodplains and wetlands during known flood years.</td>
          <td>Visual agreement with basemap hydrography; spatial overlap with “All Water” vectors.</td>
        </tr>
        <tr>
        </tr>
        <tr>
          <td>Z-score threshold remains stable despite varying image counts/incidence angle.</td>
          <td>Review μ, σ, k, threshold in the info panel; absence of spurious large areas in dry years.</td>
        </tr>
        <tr>
          <td>Vector polygons align with water bodies on the “After” composite and recede on the “Before”.</td>
          <td>Side-by-side inspection of the four images and interactive layers.</td>
        </tr>
      </tbody>
    </table>
  </div>

  <h3 style="margin-top:12px">What would falsify it?</h3>
  <ul class="bullet">
    <li>Large Z-score areas consistently appear on slopes/urban zones with no visual darkening in VV.</li>
    <li>Trends in area (km²) contradict independent seasonal signals across multiple years.</li>
    <li>Reasonable <code>k</code> values (1.0–2.0) fail to separate flood from background in typical years.</li>
  </ul>

  <p class="small-note" style="margin-top:8px">
    Note: Volume shown in the dashboard uses a simple <i>mean depth = 0.5 m</i> assumption and is intended as magnitude only.
  </p>
</section>

  </main>
</body>
</html>
