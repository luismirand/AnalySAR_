<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AnalySAR - Flood Viewer</title>

  <link rel="icon" href="img/LOGOANALYSAR.png" type="image/png"/>
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.4.0/mapbox-gl.css" rel="stylesheet"/>
  <script src="https://api.mapbox.com/mapbox-gl-js/v3.4.0/mapbox-gl.js"></script>

  <script src="https://npmcdn.com/@turf/turf@6.5.0/turf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>

  <link rel="stylesheet" href="css/style.css"/>

  <script src="config.js"></script>

  <script src="js/main.js" defer></script>
</head>
<body>
  <!-- ====================== HOME ====================== -->
  <main id="welcome-screen">
    <div class="welcome-content">
      <img src="img/LOGOANALYSAR.png" alt="AnalySAR Logo" class="welcome-logo"/>
      <h1 class="welcome-title">AnalySAR</h1>
      <p class="welcome-subtitle">
        Prototype for NASA Space Apps 2025. Explore multi-year floods in Tabasco, MX using Sentinel-1 SAR, GEE preprocessing, and a 3D web viewer.
      </p>

      <button id="enter-app-btn" class="enter-button" aria-label="Explore Map">Explore Map</button>

      <div class="home-links">
        <a class="home-link" href="analysis.html" title="How the metrics and Z-score work">Analysis</a>
        <a class="home-link" href="about.html" title="Team & background">About</a>
        <a class="home-link" href="https://github.com/luismirand/AnalySAR_" target="_blank" rel="noopener" title="Project repo">
          <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true" style="margin-right:6px"><path fill="currentColor" d="M12 .5a12 12 0 0 0-3.79 23.4c.6.11.82-.26.82-.58v-2.02c-3.34.73-4.04-1.61-4.04-1.61-.55-1.41-1.34-1.78-1.34-1.78-1.09-.75.08-.74.08-.74 1.2.08 1.83 1.24 1.83 1.24 1.07 1.83 2.8 1.3 3.48.99.11-.78.42-1.3.76-1.6-2.66-.3-5.47-1.33-5.47-5.9 0-1.3.47-2.37 1.24-3.2-.12-.3-.54-1.52.12-3.17 0 0 1.01-.32 3.3 1.22a11.5 11.5 0 0 1 6 0c2.3-1.54 3.3-1.22 3.3-1.22.66 1.65.24 2.87.12 3.17.77.83 1.24 1.9 1.24 3.2 0 4.58-2.81 5.6-5.49 5.9.43.37.81 1.1.81 2.22v3.29c0 .32.21.7.82.58A12 12 0 0 0 12 .5z"/></svg>
          GitHub
        </a>
      </div>
    </div>

    <div class="project-info-container">
      <h3>Project</h3>
      <p>
        Interactive viewer for Tabasco floods. Layers: <em>Before</em> (Oct), <em>After</em> (Nov–Dec), and <em>All Water (Inundation)</em> from a Z-score mask.
      </p>
    </div>
  </main>

  <!-- ====================== MAP APP ====================== -->
  <main id="map-app" class="hidden">
    <div id="map-container"></div>
    <div id="sidebar-overlay" class="hidden" aria-hidden="true"></div>

    <nav id="floating-nav" class="panel" aria-label="Primary">
      <a href="analysis.html" class="nav-link">Analysis</a>
      <a href="#" id="home-link" class="brand-center" aria-label="Home">
        <img src="img/LOGOANALYSAR.png" alt="AnalySAR Logo" class="app-logo"/>
        <span class="app-name">AnalySAR</span>
      </a>
      <a href="about.html" class="nav-link">About</a>
    </nav>

    <button id="kebab-left" class="kebab-btn" aria-label="Toggle left panel">⋮</button>
    <button id="kebab-right" class="kebab-btn" aria-label="Toggle right panel">⋮</button>

    <!-- Left panel -->
    <aside id="left-sidebar-container" class="side-container left">
      <section class="panel side-panel">
        <header class="side-header">
          <h2 class="side-title">Event Panel</h2>
          <button id="close-left" class="side-close" title="Close">✕</button>
        </header>

        <div class="control-group compact">
          <label>Primary stage</label>
          <div id="primary-pills" class="pill-select">
            <button class="pill active" data-stage="Antes">Oct</button>
            <button class="pill" data-stage="Después">Nov–Dec</button>
            <button class="pill" data-stage="Comparativo">All Water</button>
          </div>
          <div class="hint">Oct = “Before”, Nov–Dec = “After”, All Water = flood mask (Z-score)</div>
        </div>

        <h3 id="info-title" style="margin-top:6px;">Tabasco, Oct 2020</h3>

        <div class="card">
          <div class="card-title">General Information</div>
          <div class="info-grid spaced">
            <span>Severity</span><strong id="info-severity">—</strong>
            <span>Primary</span><strong id="primary-label-badge">Oct 2020</strong>
            <span>Area</span><strong id="info-area">— km²</strong>
            <span>Affected %</span><strong id="info-percentage">— %</strong>
            <span>Mean depth</span><strong id="info-meandepth">0.50 m</strong>
            <span>Volume</span><strong id="info-volume">— M m³</strong>
            <span>Polygons</span><strong id="info-polygons">—</strong>
          </div>
        </div>

        <div class="card">
          <div class="card-title">Area by stage (with months)</div>
          <div class="chart-container">
            <canvas id="dashboard-chart" aria-label="Event Summary Chart"></canvas>
          </div>
          <div class="chart-legend" id="chart-legend">—</div>
        </div>

        <div class="card">
          <div class="card-title row">
            <span>Z-score & Difference stats</span>
            <details class="z-help">
              <summary>What is this?</summary>
              <p>
                We compute <em>After − Before</em>. Mean (<strong>μ</strong>) and std dev (<strong>σ</strong>) over the AOI.  
                Flood = pixels where <strong>diff &lt; μ − kσ</strong>.
              </p>
            </details>
          </div>
          <div class="z-grid spaced">
            <div class="z-item"><div class="z-title">μ (mean)</div><div class="z-val" id="z-mu">—</div></div>
            <div class="z-item"><div class="z-title">σ (std dev)</div><div class="z-val" id="z-sigma">—</div></div>
            <div class="z-item"><div class="z-title">k</div><div class="z-val" id="z-k">—</div></div>
            <div class="z-item"><div class="z-title">Threshold</div><div class="z-val" id="z-threshold">—</div></div>
            <div class="z-item"><div class="z-title">Diff Min</div><div class="z-val" id="z-diffmin">—</div></div>
            <div class="z-item"><div class="z-title">Diff Max</div><div class="z-val" id="z-diffmax">—</div></div>
            <div class="z-item"><div class="z-title">Imgs (Before)</div><div class="z-val" id="z-imgs-before">—</div></div>
            <div class="z-item"><div class="z-title">Imgs (After)</div><div class="z-val" id="z-imgs-after">—</div></div>
          </div>
        </div>
      </section>
    </aside>

    <!-- Right panel -->
    <aside id="dashboard-panel" class="side-container right">
      <section class="panel side-panel">
        <header class="side-header">
          <h2 class="side-title">Control Panel</h2>
          <button id="close-right" class="side-close" title="Close">✕</button>
        </header>

        <div class="control-group">
          <label>Layers</label>
          <div id="layer-pills" class="pill-select multi">
            <button class="pill on" data-layer="before">
              <span class="dot" style="--c:#66CCFF"></span> Before (Oct)
            </button>
            <button class="pill" data-layer="after">
              <span class="dot" style="--c:#304FFE"></span> After (Nov–Dec)
            </button>
            <button class="pill" data-layer="flood">
              <span class="dot" style="--c:#FF9800"></span> All Water (Inundation)
            </button>
          </div>
          <p class="small-note">“All Water (Inundation)” is the flood mask used in our GEE workflow.</p>
        </div>

        <div class="control-group">
          <label>Map Style</label>
          <div id="map-style-controls" class="segmented-control">
            <button class="style-btn" data-style="dark-v11">Dark</button>
            <button class="style-btn active" data-style="satellite-streets-v12">Satellite</button>
          </div>
        </div>

        <div class="visualization-controls">
          <div class="control-group">
            <label for="opacity-slider">Opacity (<span id="opacity-value">100</span>%)</label>
            <input type="range" id="opacity-slider" min="0.1" max="1" step="0.05" value="1"/>
          </div>

          <div class="stacked-actions">
            <button id="toggle-labels-btn" class="btn-secondary wide" aria-pressed="false">Hide Labels</button>
            <button id="toggle-border-btn" class="btn-secondary wide" aria-pressed="true">Hide Border</button>
            <button id="toggle-3d-btn" class="btn-primary wide" aria-pressed="true">Disable 3D View</button>
          </div>
        </div>
      </section>
    </aside>

    <!-- Timeline -->
    <div id="timeline-container" class="panel timeline-with-arrows" aria-label="Timeline">
      <button id="timeline-left-btn" class="tl-arrow" aria-label="Left">
        <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true"><path d="M15 18l-6-6 6-6" fill="none" stroke="currentColor" stroke-width="2"/></svg>
      </button>
      <div id="timeline" class="timeline-wrapper" tabindex="0" aria-label="Years"></div>
      <button id="timeline-right-btn" class="tl-arrow" aria-label="Right">
        <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true"><path d="M9 6l6 6-6 6" fill="none" stroke="currentColor" stroke-width="2"/></svg>
      </button>
    </div>
  </main>
</body>
</html>
